<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>جدول کریپتو با هدر ثابت و رنگ‌بندی</title>
<style>
  body {
    font-family: Tahoma, Arial, sans-serif;
    background-color: #f7f9fc;
    direction: rtl;
    margin: 20px;
  }
  h2 {
    color: #0d47a1;
  }
  .table-wrap {
    overflow-x: auto;
    border: 1px solid #ddd;
    border-radius: 8px;
    background: white;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    min-width: 1200px; /* حداقل عرض */
  }
  th, td {
    padding: 6px 12px;
    border: 1px solid #ddd;
    text-align: center;
    white-space: nowrap;
  }
  /* هدر ثابت */
  th {
    position: sticky;
    top: 0;
    background: #e3f2fd;
    border-bottom: 2px solid #0d47a1;
    z-index: 10;
    cursor: default;
  }
  /* 5 ستون اول ثابت */
  #crypto-table th:nth-child(-n+5),
  #crypto-table td:nth-child(-n+5) {
    position: sticky;
    left: 0;
    background: #f0f7ff;
    border-right: 1px solid #ccc;
    z-index: 15;
  }
  /* تنظیم موقعیت left برای ستون‌های 2 تا 5 */
  #crypto-table th:nth-child(2),
  #crypto-table td:nth-child(2) { left: 60px; }
  #crypto-table th:nth-child(3),
  #crypto-table td:nth-child(3) { left: 120px; }
  #crypto-table th:nth-child(4),
  #crypto-table td:nth-child(4) { left: 180px; }
  #crypto-table th:nth-child(5),
  #crypto-table td:nth-child(5) { left: 240px; }

  /* عرض ستون‌های اول برای جلوگیری از بهم ریختگی */
  #crypto-table th:nth-child(1), #crypto-table td:nth-child(1) { min-width: 60px; }
  #crypto-table th:nth-child(2), #crypto-table td:nth-child(2) { min-width: 60px; }
  #crypto-table th:nth-child(3), #crypto-table td:nth-child(3) { min-width: 60px; }
  #crypto-table th:nth-child(4), #crypto-table td:nth-child(4) { min-width: 60px; }
  #crypto-table th:nth-child(5), #crypto-table td:nth-child(5) { min-width: 60px; }

  /* زیگزاگی ردیف‌ها */
  #crypto-table tbody tr:nth-child(odd) {
    background-color: #fafcff;
  }
  #crypto-table tbody tr:nth-child(even) {
    background-color: #ffffff;
  }
  /* رنگ بندی مثبت و منفی */
  .positive {
    color: green;
    font-weight: bold;
  }
  .negative {
    color: red;
    font-weight: bold;
  }
  .muted {
    color: #555;
  }
  /* Badge سیگنال‌ها */
  .badge {
    display: inline-block;
    padding: 2px 6px;
    border-radius: 12px;
    font-size: 0.8em;
    color: white;
  }
  .good {
    background-color: green;
  }
  .bad {
    background-color: red;
  }
  .neutral {
    background-color: gray;
  }
  /* Tooltip بصورت title استفاده شده، استایل خاص نیاز نیست */
</style>
</head>
<body>

<h2>جدول کریپتوکارنسی با ویژگی‌های پیشرفته</h2>
<div class="table-wrap">
  <table id="crypto-table">
    <thead>
      <tr>
        <th title="نماد ارز">Symbol</th>
        <th title="قیمت لحظه‌ای">Price</th>
        <th title="شاخص قدرت نسبی (RSI) 14 دوره">RSI(14)</th>
        <th title="میانگین متحرک نمایی 9 دوره">EMA9</th>
        <th title="میانگین متحرک نمایی 20 دوره">EMA20</th>
        <th title="میانگین متحرک نمایی 50 دوره">EMA50</th>
        <th title="میانگین متحرک نمایی 100 دوره">EMA100</th>
        <th title="شاخص MACD">MACD</th>
        <th title="خط سیگنال MACD">Signal</th>
        <th title="سیگنال خرید (Long)">L</th>
        <th title="سیگنال فروش (Short)">S</th>
        <th title="Pivot Point روزانه">PP</th>
        <th title="سیگنال خرید">Long</th>
        <th title="سیگنال فروش">Short</th>
        <th title="قیمت ورود">Entry</th>
        <th title="قیمت خروج (Take Profit / Stop Loss)">Exit (TP/SL)</th>
        <th title="سطح حمایت">Support</th>
        <th title="سطح مقاومت">Resistance</th>
        <th title="تثبیت روی حمایت؟">تثبیت روی حمایت؟</th>
        <th title="تثبیت روی مقاومت؟">تثبیت روی مقاومت؟</th>
        <th title="Breakout">Breakout</th>
        <th title="Bounce">Bounce</th>
        <th title="Golden Cross">Golden Cross</th>
        <th title="Rally">Rally</th>
      </tr>
    </thead>
    <tbody>
      <!-- داده‌ها با JS پر می‌شوند -->
    </tbody>
  </table>
</div>

<script>
  const DATA = [
    {
      "symbol": "BTCUSDT",
      "last": 28417.0,
      "rsi": 60.03,
      "ema9": 28360.66,
      "ema20": 28374.25,
      "ema50": 28323.17,
      "ema100": 27840.91,
      "macd": 12.45,
      "signal": 10.22,
      "L": 28390,
      "S": 28400,
      "PP": 28350,
      "Long": true,
      "Short": false,
      "entry": 28395,
      "exitPlan": "28500 / 28200",
      "support": 28250,
      "resistance": 28500,
      "onSupport": "بله",
      "onResistance": "خیر",
      "breakout": "خیر",
      "bounce": "بله",
      "golden": "خیر",
      "rally": "بله"
    },
    {
      "symbol": "ETHUSDT",
      "last": 1802.5,
      "rsi": 72.1,
      "ema9": 1790.5,
      "ema20": 1785.8,
      "ema50": 1770.3,
      "ema100": 1750.2,
      "macd": -5.12,
      "signal": -4.8,
      "L": 1795,
      "S": 1800,
      "PP": 1780,
      "Long": false,
      "Short": true,
      "entry": 1798,
      "exitPlan": "1810 / 1780",
      "support": 1770,
      "resistance": 1820,
      "onSupport": "خیر",
      "onResistance": "بله",
      "breakout": "بله",
      "bounce": "خیر",
      "golden": "بله",
      "rally": "خیر"
    },
    // داده‌های بیشتر به همین صورت ...
  ];

  function fmt(v, decimals=2){
    if(v==null) return "—";
    return v.toFixed(decimals);
  }

  function buildTable(){
    const tbody = document.querySelector("#crypto-table tbody");
    tbody.innerHTML = "";

    DATA.forEach(item => {
      const {
        symbol, last, rsi, ema9, ema20, ema50, ema100,
        macd, signal, L, S, PP, Long: longCond, Short: shortCond,
        entry, exitPlan, support, resistance, onSupport, onResistance,
        breakout, bounce, golden, rally
      } = item;

      // کلاس رنگی RSI
      let rsiClass = "muted";
      if(rsi >= 70) rsiClass = "negative";
      else if(rsi <= 30) rsiClass = "positive";

      // کلاس مثبت/منفی MACD و سیگنال
      const macdClass = (macd != null && signal != null && (macd - signal) >= 0) ? "positive" : "negative";

      // Badge سیگنال
      const longBadge  = longCond  ? '<span class="badge good">✅</span>' : '<span class="badge neutral">—</span>';
      const shortBadge = shortCond ? '<span class="badge bad">⚠</span>'  : '<span class="badge neutral">—</span>';

      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td class="nowrap">${symbol}</td>
        <td>${fmt(last,4)}</td>
        <td><span class="${rsiClass}">${fmt(rsi,2)}</span></td>
        <td>${fmt(ema9,4)}</td>
        <td>${fmt(ema20,4)}</td>
        <td>${fmt(ema50,4)}</td>
        <td>${fmt(ema100,4)}</td>
        <td class="${macdClass}">${fmt(macd,6)}</td>
        <td class="${macdClass}">${fmt(signal,6)}</td>
        <td>${L}</td>
        <td>${S}</td>
        <td>${PP}</td>
        <td>${longBadge}</td>
        <td>${shortBadge}</td>
        <td>${entry}</td>
        <td>${exitPlan}</td>
        <td>${fmt(support,4)}</td>
        <td>${fmt(resistance,4)}</td>
        <td>${onSupport}</td>
        <td>${onResistance}</td>
        <td>${breakout}</td>
        <td>${bounce}</td>
        <td>${golden}</td>
        <td>${rally}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  buildTable();
</script>

</body>
</html>

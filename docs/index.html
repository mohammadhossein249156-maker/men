<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ“Š Crypto Dashboard</title>
  <style>
    body { font-family: Tahoma, sans-serif; direction: rtl; background:#f7f7f7; padding:20px; }
    table { border-collapse: collapse; width: 100%; background:#fff; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #333; color: #fff; }
  </style>
</head>
<body>
  <h1>ğŸ“Š Crypto Dashboard</h1>
  <label>â± Ø§Ù†ØªØ®Ø§Ø¨ ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ…:
    <select id="interval">
      <option value="15m">15m</option>
      <option value="1h">1h</option>
      <option value="4h">4h</option>
      <option value="1d">1d</option>
    </select>
  </label>
  <br><br>

  <table id="crypto-table">
    <thead>
      <tr>
        <th>Symbol</th>
        <th>Price (USDT)</th>
        <th>RSI</th>
        <th>EMA9</th>
        <th>EMA20</th>
        <th>EMA50</th>
        <th>EMA100</th>
        <th>MACD</th>
        <th>Signal</th>
        <th>Long</th>
        <th>Short</th>
        <th>Entry Price</th>
        <th>Exit Price</th>
        <th>Support</th>
        <th>Resistance</th>
      </tr>
    </thead>
    <tbody id="crypto-body"></tbody>
  </table>

  <script>
    const symbols = ["BTCUSDT","ETHUSDT"];

    async function fetchKlines(symbol, interval="15m") {
      try {
        let url = `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(
          "https://api.binance.com/api/v3/klines?symbol=" + symbol + "&interval=" + interval + "&limit=100"
        )}`;
        let res = await fetch(url);
        let klines = await res.json();
        if (!Array.isArray(klines)) throw new Error("Not array: " + JSON.stringify(klines));
        return klines;
      } catch (e) {
        console.error("âŒ Error for", symbol, e);
        return null;
      }
    }

    async function updateTable() {
      let interval = document.getElementById("interval").value;
      let tbody = document.getElementById("crypto-body");
      tbody.innerHTML = "";

      for (let sym of symbols) {
        let row = document.createElement("tr");
        let klines = await fetchKlines(sym, interval);
        if (!klines) {
          row.innerHTML = `<td>${sym}</td><td colspan="13">âŒ API Error</td>`;
        } else {
          let lastClose = parseFloat(klines[klines.length-1][4]);
          row.innerHTML = `
            <td>${sym}</td>
            <td>${lastClose}</td>
            <td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td>
            <td>â€”</td><td>â€”</td><td>â€”</td>
            <td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td>
          `;
        }
        tbody.appendChild(row);
      }
    }

    document.getElementById("interval").addEventListener("change", updateTable);
    updateTable();
  </script>
</body>
</html>
